<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="111214">
	<meta name="msapplication-TileColor" content="111214">
<meta itemprop="name" content="Angular通过ControlValueAccessor自定义组件中实现双向绑定">
<meta itemprop="description" content="今天俺滴前端mentor布置了一个小任务：利用ControlValueAccessor将组件改为双向绑定的自定义组件。起初以为a piece of cake，真正实现的时候却由于理解不透彻出现了大问题。经过婷姐答疑解惑，也算照葫芦画瓢做出来了，但事后也模棱两可。晚上加班加点查阅大量博客，总算弄懂一些皮毛，以下是笔者的学习笔记。
1、表单与控件介绍 在大部分Web应用中，用表单来处理输入是非常基础的功能，通常会在控件类中定义一个FormControl属性，然后在模板中通过[formControl]将DOM与数据进行双向绑定，如下所示：
import { Component } from &#39;@angular/core&#39;; import { FormControl } from &#39;@angular/forms&#39;; @Component({ selector: &#39;app-my-control&#39;, template: ` &lt;input type=&#34;text&#34; [formControl]=&#34;myControl&#34;&gt; ` }) export class MyControlComponent { myrControl = new FormControl(&#39;&#39;); } 在一些复杂场景中，考虑到代码复用以及安全性，难免需要自定义一些表单组件，也就不可避免的会涉及到数据的双向绑定问题。
一个简单粗暴的方法就是通过@Input来将父组件的表单数据传到子组件（自定义表单组件），然后在控件中写入对应的逻辑。其本质原理其实就是父子组件的事件绑定机制。假设我们现在有一个控件my-component，具体的调用可能长成这样：
&lt;my-component [(myModel)]=&#34;inputValue&#34; (myModelChange)=&#34;onInputValueChange($event)&#34;&gt; &lt;/my-component&gt; 又臭又烂，对吧？显然不够简洁与优雅。我们希望它能够像其他的表单类元素一样，直接通过 formControlName 来绑定数据：
&lt;form [formGroup]=&#34;form&#34;&gt; &lt;input formControlName=&#34;&#34; /&gt; &lt;my-component type=&#34;text&#34; formControlName=&#34;myFormConotrol&#34;&gt;&lt;/my-component&gt; &lt;/form&gt; 这时候我们就需要ControlValueAccessor来实现，下面步入正题！！
2、ControlValueAccessor API 介绍 ControlValueAccessor的官方定义是
Implement this interface to create a custom form control directive that integrates with Angular forms."><meta itemprop="datePublished" content="2022-07-26T23:38:40+08:00" />
<meta itemprop="dateModified" content="2022-07-26T23:38:40+08:00" />
<meta itemprop="wordCount" content="967">
<meta itemprop="keywords" content="front-end," /><meta property="og:title" content="Angular通过ControlValueAccessor自定义组件中实现双向绑定" />
<meta property="og:description" content="今天俺滴前端mentor布置了一个小任务：利用ControlValueAccessor将组件改为双向绑定的自定义组件。起初以为a piece of cake，真正实现的时候却由于理解不透彻出现了大问题。经过婷姐答疑解惑，也算照葫芦画瓢做出来了，但事后也模棱两可。晚上加班加点查阅大量博客，总算弄懂一些皮毛，以下是笔者的学习笔记。
1、表单与控件介绍 在大部分Web应用中，用表单来处理输入是非常基础的功能，通常会在控件类中定义一个FormControl属性，然后在模板中通过[formControl]将DOM与数据进行双向绑定，如下所示：
import { Component } from &#39;@angular/core&#39;; import { FormControl } from &#39;@angular/forms&#39;; @Component({ selector: &#39;app-my-control&#39;, template: ` &lt;input type=&#34;text&#34; [formControl]=&#34;myControl&#34;&gt; ` }) export class MyControlComponent { myrControl = new FormControl(&#39;&#39;); } 在一些复杂场景中，考虑到代码复用以及安全性，难免需要自定义一些表单组件，也就不可避免的会涉及到数据的双向绑定问题。
一个简单粗暴的方法就是通过@Input来将父组件的表单数据传到子组件（自定义表单组件），然后在控件中写入对应的逻辑。其本质原理其实就是父子组件的事件绑定机制。假设我们现在有一个控件my-component，具体的调用可能长成这样：
&lt;my-component [(myModel)]=&#34;inputValue&#34; (myModelChange)=&#34;onInputValueChange($event)&#34;&gt; &lt;/my-component&gt; 又臭又烂，对吧？显然不够简洁与优雅。我们希望它能够像其他的表单类元素一样，直接通过 formControlName 来绑定数据：
&lt;form [formGroup]=&#34;form&#34;&gt; &lt;input formControlName=&#34;&#34; /&gt; &lt;my-component type=&#34;text&#34; formControlName=&#34;myFormConotrol&#34;&gt;&lt;/my-component&gt; &lt;/form&gt; 这时候我们就需要ControlValueAccessor来实现，下面步入正题！！
2、ControlValueAccessor API 介绍 ControlValueAccessor的官方定义是
Implement this interface to create a custom form control directive that integrates with Angular forms." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://LeiBuDao.github.io/posts/angular_controlvalueaccessor/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-26T23:38:40+08:00" />
<meta property="article:modified_time" content="2022-07-26T23:38:40+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Angular通过ControlValueAccessor自定义组件中实现双向绑定"/>
<meta name="twitter:description" content="今天俺滴前端mentor布置了一个小任务：利用ControlValueAccessor将组件改为双向绑定的自定义组件。起初以为a piece of cake，真正实现的时候却由于理解不透彻出现了大问题。经过婷姐答疑解惑，也算照葫芦画瓢做出来了，但事后也模棱两可。晚上加班加点查阅大量博客，总算弄懂一些皮毛，以下是笔者的学习笔记。
1、表单与控件介绍 在大部分Web应用中，用表单来处理输入是非常基础的功能，通常会在控件类中定义一个FormControl属性，然后在模板中通过[formControl]将DOM与数据进行双向绑定，如下所示：
import { Component } from &#39;@angular/core&#39;; import { FormControl } from &#39;@angular/forms&#39;; @Component({ selector: &#39;app-my-control&#39;, template: ` &lt;input type=&#34;text&#34; [formControl]=&#34;myControl&#34;&gt; ` }) export class MyControlComponent { myrControl = new FormControl(&#39;&#39;); } 在一些复杂场景中，考虑到代码复用以及安全性，难免需要自定义一些表单组件，也就不可避免的会涉及到数据的双向绑定问题。
一个简单粗暴的方法就是通过@Input来将父组件的表单数据传到子组件（自定义表单组件），然后在控件中写入对应的逻辑。其本质原理其实就是父子组件的事件绑定机制。假设我们现在有一个控件my-component，具体的调用可能长成这样：
&lt;my-component [(myModel)]=&#34;inputValue&#34; (myModelChange)=&#34;onInputValueChange($event)&#34;&gt; &lt;/my-component&gt; 又臭又烂，对吧？显然不够简洁与优雅。我们希望它能够像其他的表单类元素一样，直接通过 formControlName 来绑定数据：
&lt;form [formGroup]=&#34;form&#34;&gt; &lt;input formControlName=&#34;&#34; /&gt; &lt;my-component type=&#34;text&#34; formControlName=&#34;myFormConotrol&#34;&gt;&lt;/my-component&gt; &lt;/form&gt; 这时候我们就需要ControlValueAccessor来实现，下面步入正题！！
2、ControlValueAccessor API 介绍 ControlValueAccessor的官方定义是
Implement this interface to create a custom form control directive that integrates with Angular forms."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Angular通过ControlValueAccessor自定义组件中实现双向绑定</title>
	<link rel="stylesheet" href="https://LeiBuDao.github.io/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css" integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin="anonymous">


</head>

<body id="page">
	
<header id="site-header" class="animated slideInUp">
	<div class="hdr-wrapper section-inner">
		<div class="hdr-left">
			<div class="site-branding">
				<a href="https://LeiBuDao.github.io/">Run</a>
			</div>
			<nav class="site-nav hide-in-mobile">
				
				<a href="https://LeiBuDao.github.io/about-myblog/">About</a>
				<a href="https://LeiBuDao.github.io/posts/">Blogs</a>
				<a href="https://LeiBuDao.github.io/project/">Project</a>
				<a href="https://LeiBuDao.github.io/contact-me/">Contact Me</a>

			</nav>
		</div>
		<div class="hdr-right hdr-icons">
			<span class="hdr-social hide-in-mobile"><a href="https://github.com/LeiBuDao" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg></a><a href="https://web.telegram.org" target="_blank" rel="noopener me" title="Telegram"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M21.198 2.433a2.242 2.242 0 0 0-1.022.215l-8.609 3.33c-2.068.8-4.133 1.598-5.724 2.21a405.15 405.15 0 0 1-2.849 1.09c-.42.147-.99.332-1.473.901-.728.968.193 1.798.919 2.286 1.61.516 3.275 1.009 4.654 1.472.509 1.793.997 3.592 1.48 5.388.16.36.506.494.864.498l-.002.018s.281.028.555-.038a2.1 2.1 0 0 0 .933-.517c.345-.324 1.28-1.244 1.811-1.764l3.999 2.952.032.018s.442.311 1.09.355c.324.022.75-.04 1.116-.308.37-.27.613-.702.728-1.196.342-1.492 2.61-12.285 2.997-14.072l-.01.042c.27-1.006.17-1.928-.455-2.474a1.654 1.654 0 0 0-1.034-.407z" />
</svg></a><a href="https://instagram.com/" target="_blank" rel="noopener me" title="Instagram"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
    <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg></a><a href="https://space.bilibili.com/438672729" target="_blank" rel="noopener me" title="Bilibili"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a></span><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg"
					width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
					stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg></button>
		</div>
	</div>

</header>
<div id="mobile-menu" class="animated fast">
	<ul>
		<li><a href="https://LeiBuDao.github.io/about-myblog/">About</a></li>
		<li><a href="https://LeiBuDao.github.io/posts/">Blogs</a></li>
		<li><a href="https://LeiBuDao.github.io/project/">Project</a></li>
		<li><a href="https://LeiBuDao.github.io/contact-me/">Contact Me</a></li>
	</ul>
</div>

<main class="site-main section-inner animated fadeIn faster">
	<article class="thin">
		<header class="post-header">
			<div class="post-meta"><span>Jul 26, 2022</span></div>
			<h1>Angular通过ControlValueAccessor自定义组件中实现双向绑定</h1>
		</header>
		<div class="content">
			<blockquote>
<p>今天俺滴前端mentor布置了一个小任务：利用ControlValueAccessor将组件改为双向绑定的自定义组件。起初以为a piece of cake，真正实现的时候却由于理解不透彻出现了大问题。经过婷姐答疑解惑，也算照葫芦画瓢做出来了，但事后也模棱两可。晚上加班加点查阅大量博客，总算弄懂一些皮毛，以下是笔者的学习笔记。</p>
</blockquote>
<h3 id="1表单与控件介绍">1、表单与控件介绍<a href="#1表单与控件介绍" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h3>
<p>在大部分Web应用中，用表单来处理输入是非常基础的功能，通常会在控件类中定义一个<code>FormControl</code>属性，然后在模板中通过<code>[formControl]</code>将DOM与数据进行双向绑定，如下所示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">FormControl</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-my-control&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;input type=&#34;text&#34; [formControl]=&#34;myControl&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">MyControlComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">myrControl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在一些复杂场景中，考虑到代码复用以及安全性，难免需要自定义一些表单组件，也就不可避免的会涉及到数据的双向绑定问题。</p>
<p>一个简单粗暴的方法就是通过<code>@Input</code>来将父组件的表单数据传到子组件（自定义表单组件），然后在控件中写入对应的逻辑。其本质原理其实就是父子组件的事件绑定机制。假设我们现在有一个控件<code>my-component</code>，具体的调用可能长成这样：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">my-component</span> 
</span></span><span class="line"><span class="cl"> 	<span class="err">[(</span><span class="na">myModel</span><span class="err">)]=&#34;</span><span class="na">inputValue</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="err">(</span><span class="na">myModelChange</span><span class="err">)=&#34;</span><span class="na">onInputValueChange</span><span class="err">($</span><span class="na">event</span><span class="err">)&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">my-component</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>又臭又烂，对吧？显然不够简洁与优雅。我们希望它能够像其他的表单类元素一样，直接通过 <code>formControlName</code> 来绑定数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&#34;</span><span class="na">form</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">my-component</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;myFormConotrol&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">my-component</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>这时候我们就需要ControlValueAccessor来实现，下面步入正题！！</p>
<h3 id="2controlvalueaccessor-api-介绍">2、ControlValueAccessor API 介绍<a href="#2controlvalueaccessor-api-介绍" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h3>
<p>ControlValueAccessor的官方定义是</p>
<blockquote>
<p>Implement this interface to create a custom form control directive that integrates with Angular forms.</p>
</blockquote>
<p>简单来说就是，它可以在Angular的 FormControl 实例和原生 DOM 元素之间创建一个桥梁，进行双向绑定。任何一个控件或指令都可以通过实现 <code>ControlValueAccessor</code> 接口并注册为 <code>NG_VALUE_ACCESSOR</code>，从而转变成 <code>ControlValueAccessor</code> 类型的对象。</p>
<p>我们需要实现该接口的以下方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 给外部formControl写入数据时调用该方法。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 其作用是设置原生表单控件的值
</span></span></span><span class="line"><span class="cl"><span class="cm">   * @param {*} value 
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">writeValue</span><span class="p">(</span><span class="nx">obj</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 注册 onChange 事件，在初始化的时候被调用
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 我们首先要在 registerOnChange 中将该事件触发函数保存起来，等到合适的时候（比如控件收    * 到用户输入，需要作出响应时）调用该函数以触发事件。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * @param {*} fn 
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">registerOnChange</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 注册 onTouched 事件，即用户和控件交互时触发的回调函数。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 该函数用于通知表单控件已经处于 touched 状态，以更新绑定的 FormContorl 的内部状态。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * @param {*} fn 
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">registerOnTouched</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当表单状态变为 DISABLED 或从 DISABLED 变更时，表单 API 会调用该方法，以启用或禁用    * 对应的 DOM 元素。
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setDisabledState</span><span class="p">(</span><span class="nx">isDisabled</span>: <span class="kt">boolean</span><span class="p">)</span><span class="o">?:</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="3-自定义表单控件实现">3、 自定义表单控件实现<a href="#3-自定义表单控件实现" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h3>
<h4 id="31初始化自定义表单控件">3.1、初始化自定义表单控件<a href="#31初始化自定义表单控件" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h4>
<p>假设我们需要实现一个demo组件，包含了ts脚本和一个html组件：</p>
<blockquote>
<p>demo.component.html</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>当前值: {{ value }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">increment</span><span class="err">()&#34;</span><span class="p">&gt;</span> + <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">decrement</span><span class="err">()&#34;</span><span class="p">&gt;</span> - <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></div><blockquote>
<p>demo.component.ts</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-demo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./demo.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./demo.component.css&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">Demo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">@Input</span><span class="p">()</span> <span class="nx">value</span>: <span class="kt">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ngOnInit() {</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">increment() {</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">decrement() {</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="32-注册-ng_value_accessor-提供者">3.2 注册 NG_VALUE_ACCESSOR 提供者<a href="#32-注册-ng_value_accessor-提供者" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h4>
<blockquote>
<p><code>NG_VALUE_ACCESSOR</code> 提供者用来指定实现了 <code>ControlValueAccessor</code> 接口的类，并且被 Angular 用来和 <code>formControl</code> 同步，通常是使用控件类或指令来注册。所有表单指令都是使用<code>NG_VALUE_ACCESSOR</code> 标识来注入控件值访问器，然后选择合适的访问器。具体分以下几个步骤：</p>
</blockquote>
<p>步骤1：创建 EXE_COUNTER_VALUE_ACCESSOR</p>
<pre tabindex="0"><code>export const EXE_COUNTER_VALUE_ACCESSOR: any = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() =&gt; DemoComponent),
    multi: true
};
</code></pre><p>步骤2：配置控件 providers 信息</p>
<pre tabindex="0"><code>@Component({
  ...
  providers: [EXE_COUNTER_VALUE_ACCESSOR],
  ...
})
export class Demo implements OnInit, ControlValueAccessor {
  ...
}
</code></pre><h4 id="33-完善-controlvalueaccessor-接口">3.3 完善 ControlValueAccessor 接口<a href="#33-完善-controlvalueaccessor-接口" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h4>
<p>根据 ControlValueAccessor 定义的 API 接口，当合法值输入控件时，我们需要更新控件内的 count 值，所以我们这样完善 writeValue 方法：</p>
<pre tabindex="0"><code>writeValue(value: any) {
    if (value!==undefined) {
        this._value = value;
    }
}
</code></pre><p>然后我们注册两个事件，涉及到 registerOnChange 方法和 registerOnTouched 方法：</p>
<pre tabindex="0"><code>propagateOnChange: (value: any) =&gt; void = (_: any) =&gt; {};
propagateOnTouched: (value: any) =&gt; void = (_: any) =&gt; {};

registerOnChange(fn: any) {
    this.propagateOnChange = fn;
}

registerOnTouched(fn: any) {
    this.propagateOnTouched = fn;
}
</code></pre><p>由于控件内 value 改变时我们需要调用事件触发函数将数据传递给 Angular form，于是针对控件内部的 value 我们做一些改造：</p>
<pre tabindex="0"><code>_value: number = 0;

get value() {
    return this._value;
}

set value(value: number) {
    this._value = value;
    this.propagateOnChange(this._value);
}
</code></pre><p>其余内容不变。</p>
<h4 id="34在响应式表单使用">3.4、在响应式表单使用<a href="#34在响应式表单使用" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h4>
<p>假设我们是在一个叫home的 component 中调用它，那么代码分以下两步，首先是 HTML：</p>
<pre tabindex="0"><code>&lt;form [formGroup]=&#34;form&#34;&gt;
        &lt;app-counter formControlName=&#34;counter&#34;&gt;&lt;/app-counter&gt;
&lt;/form&gt;
</code></pre><p>其次，我们完善 ts 代码：</p>
<pre tabindex="0"><code>export class HomeComponent implements OnInit {
    form: FormGroup;

    constructor(private fb: FormBuilder) { }

    ngOnInit() {
        this.form = this.fb.group({
            counter: 5 // 设置初始值
        });
    }
}
</code></pre><p>附counter.component.ts源码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">forwardRef</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">NG_VALUE_ACCESSOR</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">EXE_COUNTER_VALUE_ACCESSOR</span>: <span class="kt">any</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">provide</span>: <span class="kt">NG_VALUE_ACCESSOR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useExisting</span>: <span class="kt">forwardRef</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Counter</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">multi</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-counter&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./counter.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./counter.component.css&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span><span class="nx">EXE_COUNTER_VALUE_ACCESSOR</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">Counter</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">_value</span>: <span class="kt">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">get</span> <span class="nx">value() {</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">set</span> <span class="nx">value</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">propagateOnChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">propagateOnChange</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="nx">propagateOnTouched</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ngOnInit() {</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">writeValue</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="o">!==</span><span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">registerOnChange</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">propagateOnChange</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">registerOnTouched</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">propagateOnTouched</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">increment() {</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">decrement() {</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="4进阶例子">4、进阶例子<a href="#4进阶例子" class="anchor"
					aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
						stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg></a></h4>
<p>假设我们有一个名为<code>education</code>的自定义表单控件，而<code>add</code>也是一个表单组件，我们需要在<code>add.component</code>中引用<code>education.component</code>,大概长这样：
<img src="../../image/Angular_ControlValueAccessor/1.png" alt="">
源码(截取部分)如下:</p>
<blockquote>
<p>education.component.html</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">nz-form</span> <span class="err">[</span><span class="na">style</span><span class="err">.</span><span class="na">flex</span><span class="err">]=&#34;</span><span class="na">1</span><span class="err">&#34;</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&#34;</span><span class="na">formArray</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nz-form-item</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&#34;let fg of formArray.controls; let i = index&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-row</span> <span class="err">[</span><span class="na">nzGutter</span><span class="err">]=&#34;</span><span class="na">24</span><span class="err">&#34;</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&#34;</span><span class="na">fg</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">5</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            	<span class="p">&lt;</span><span class="nt">nz-select</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;degree&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              		<span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;本科&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;本科&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              		<span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;研究生&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;研究生&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            	<span class="p">&lt;/</span><span class="nt">nz-select</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            	<span class="p">&lt;</span><span class="nt">input</span> <span class="na">nz-input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;school&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">4</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">nz-select</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;bachelor&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;学士&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;学士&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;硕士&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;硕士&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;博士&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;博士&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&lt;</span><span class="nt">nz-option</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;无&#34;</span> <span class="na">nzLabel</span><span class="o">=</span><span class="s">&#34;无&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">nz-select</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             <span class="p">&lt;</span><span class="nt">nz-form-control</span> <span class="na">nz-col</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">nz-date-picker</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;graduationTime&#34;</span> <span class="err">(</span><span class="na">ngModelChange</span><span class="err">)=&#34;</span><span class="na">onChange</span><span class="err">($</span><span class="na">event</span><span class="err">)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">nz-date-picker</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">1</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">i</span> <span class="na">nz-icon</span> <span class="na">nzType</span><span class="o">=</span><span class="s">&#34;minus-circle-o&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;my-input-suffix-icon&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="err">(</span><span class="na">click</span><span class="err">)=&#34;</span><span class="na">removeField</span><span class="err">($</span><span class="na">event</span><span class="err">,</span> <span class="na">i</span><span class="err">,</span> <span class="na">formArray</span><span class="err">)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><blockquote>
<p>education.component.ts</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">forwardRef</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">FormArray</span><span class="p">,</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">FormControl</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">NG_VALUE_ACCESSOR</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-education&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./education.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./education.component.css&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">provide</span>: <span class="kt">NG_VALUE_ACCESSOR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">useExisting</span>: <span class="kt">forwardRef</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">EducationComponent</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">multi</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EducationComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">formArray</span>: <span class="kt">FormArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_value</span>: <span class="kt">any</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">onTouchedCallback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">onChangeCallback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span>: <span class="kt">FormBuilder</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">removeField</span><span class="p">(</span><span class="nx">e</span>: <span class="kt">MouseEvent</span><span class="p">,</span> <span class="nx">i</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">form</span>: <span class="kt">FormArray</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">fa</span> <span class="o">=</span> <span class="nx">form</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">fa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">fa</span><span class="p">.</span><span class="nx">removeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">initForm() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">formArray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">array</span><span class="p">([]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">formArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">degree</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">school</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bachelor</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">graduationTime</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">));</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">formArray</span><span class="p">.</span><span class="nx">valueChanges</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">formArray</span><span class="p">.</span><span class="nx">valid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formArray</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">onChangeCallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">get</span> <span class="nx">value</span><span class="p">()</span><span class="o">:</span> <span class="kt">any</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">set</span> <span class="nx">value</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">onChangeCallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">initForm</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">writeValue</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;write value&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">registerOnChange</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">onChangeCallback</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="nx">registerOnTouched</span><span class="p">(</span><span class="nx">fn</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">onTouchedCallback</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>add.component.html</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">nz-form</span>  <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&#34;</span><span class="na">validateForm</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>姓名<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">12</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">nz-input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>性别<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-radio-group</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;sex&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">nz-radio</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;男&#34;</span><span class="p">&gt;</span>男<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">nz-radio</span> <span class="na">nzValue</span><span class="o">=</span><span class="s">&#34;女&#34;</span><span class="p">&gt;</span>女<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-radio-group</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>年龄<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">nz-input-number</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;age&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">nz-input-number</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>手机号<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">12</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">nz-inpu</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;phone&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">12</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">nz-input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">nz-col</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">7</span><span class="err">&#34;</span> <span class="na">nzRequired</span><span class="p">&gt;</span>地址<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span> <span class="err">[</span><span class="na">nzSpan</span><span class="err">]=&#34;</span><span class="na">12</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">nz-input</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;address&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;education&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>教育情况<span class="p">&lt;/</span><span class="nt">nz-form-label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">app-education</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&#34;educations&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">app-education</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">nz-form-control</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">nz-form-item</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><blockquote>
<p>add.component.ts</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">Input</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">EducationComponent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;src/app/components/education/education.component&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">AbstractControl</span><span class="p">,</span> <span class="nx">Form</span><span class="p">,</span> <span class="nx">FormArray</span><span class="p">,</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">FormControl</span><span class="p">,</span> <span class="nx">FormGroup</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-add&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./add.component.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./add.component.css&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AddComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">validateForm</span>: <span class="kt">FormGroup</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">public</span> <span class="nx">educations</span>: <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span>: <span class="kt">FormBuilder</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">,</span> <span class="nx">maxLength</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nx">minLength</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">userNameAsyncValidator</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sex</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">age</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">phone</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">,</span> <span class="nx">phone</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">,</span> <span class="nx">email</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">address</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">educations</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div>
		</div>
		<hr class="post-end">
		<footer class="post-info">
			<p>
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
					class="feather feather-tag meta-icon">
					<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
					<line x1="7" y1="7" x2="7" y2="7"></line>
				</svg><span class="tag"><a href="https://LeiBuDao.github.io/%20tags/front-end">front-end</a></span>
			</p>
			<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
					class="feather feather-file-text">
					<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
					<polyline points="14 2 14 8 20 8"></polyline>
					<line x1="16" y1="13" x2="8" y2="13"></line>
					<line x1="16" y1="17" x2="8" y2="17"></line>
					<polyline points="10 9 9 9 8 9"></polyline>
				</svg>967 Words</p>
			<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
					class="feather feather-calendar">
					<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
					<line x1="16" y1="2" x2="16" y2="6"></line>
					<line x1="8" y1="2" x2="8" y2="6"></line>
					<line x1="3" y1="10" x2="21" y2="10"></line>
				</svg>26267-726-40 23:38 &#43;0800</p>


		</footer>
	</article>
	<div class="post-nav thin">
		<a class="prev-post" href="https://LeiBuDao.github.io/posts/angular_study/">
			<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24"
					height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
					stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right">
					<line x1="5" y1="12" x2="19" y2="12"></line>
					<polyline points="12 5 19 12 12 19"></polyline>
				</svg></span><br><span>Angular_study</span>
		</a>
	</div>
	<div id="comments" class="thin">
</div>
</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2022 <a href="https://LeiBuDao.github.io/"> MADE BY RUNXU</a> &#183;<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener"> </a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://LeiBuDao.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://LeiBuDao.github.io/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js" integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin="anonymous"></script>
	

</body>

</html>
